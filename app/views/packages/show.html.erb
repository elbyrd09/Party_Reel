
<div class="container col-12 col-md-6 col-lg-6 col-sm-12">
  <div class="row d-flex justify-content-center">
    <img src=" <%= asset_path(@event.local_img) %>" alt="event picture">
        <div class="row w-100 d-flex justify-content-center">
          <%= render 'shared/progress_bar' %><br>
        </div>
            <div class="container">
                <div class="col-8 my-4 package-show-card">
                <!-- <div class="event-show-card "> -->
                  <p> Selected: <%= @event.name %> ~ <strong><%= @event.start_date.strftime("%B %d") %></strong></p>
                </div>
                  <div class="col-8 pack-details">
                    <p style="color: black">You have chosen the <%= @package.name %> package which is a <%= @package.session %></p><br><br>
                    <p style="color: black">Guranteed 1 hour worth of shooting and minimum of 30 photographs</p><br>
                  </div>
      <!-- Carousel with navigation -->
        <div class="photographer-carousel col-12 col-lg-4 col-md-4 col-sm-12">
          <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <!-- Carousel content (each with individual modal) -->
                <% @photographers_present.each_with_index do |photographer, index| %>
                  <% active = 'active' if index == 0 %>
                  <div class="carousel-item <%= active %>">
              <p>Please select one of our professionally rated photographers below</p>
                    <a data-toggle="modal" data-target="#photographerModal<%= photographer.id %>" >
                      <div class="py-3">
                        <h4><%= photographer.user.first_name%> <%=photographer.user.last_name %></h4>
                        <img src="<%= asset_path("favourite-31@3x.png") %>" class="pgr-avatar-user avatar-bordered mario-star" />
                        <p class="py-3">Rating: <%= rand(4.0..5.0).round(1) %> </p>
                        <p> <%= photographer.user.first_name %> has worked with <%= rand(30..50) %> Party Reel clients </p>
                      </div>
                     </a>
                   </div>
                 <% active ='' %>
                 </div>
        </div>
     </div>
    </div>
  </div>
</div>
                  <!-- Modal created INSIDE each iteration to refer to that particular photographer -->
              <div class="modal fade" id="photographerModal<%= photographer.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">

                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">
                              <% case @package.name %>
                                <% when "Timezones" %>
                                  <p><%= photographer.user.first_name %> <%= photographer.user.last_name %> can shoot <strong>Timezones</strong> on <strong> <%= @event.start_date.strftime("%B %d") %> </strong> with your group!</p>
                                <% when "How do you want it?" %>
                                  <p><strong>How do you want it?:</strong> booking with <%= photographer.user.first_name %> <%= photographer.user.last_name %> </p>
                                <% when "SICKO Mode" %>
                                  <p> SICKO Mode with <%= photographer.user.first_name %> <%= photographer.user.last_name %> all day <%= @event.start_date.strftime("%A, %B %d") %> at <%= @event.name %>. Your status = <strong> BALLER!</strong>!</p>
                               <% end %>
                            </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>

                          <div class="modal-body"  style="color: black;">
                            <h3><%= photographer.user.first_name %> <%= photographer.user.last_name %></h3>
                            <p> <%= photographer.profession %></p>
                            <p> Instagram: <%= photographer.user.user_ig_handle %></p>
                            <p> Located in: <%= photographer.user.location %></p>
                            <p> Camera: <%= photographer.camera %></p>
                            <% photographer.photographerspecialties.each do |photographer_specialty| %>
                              <p> <%= photographer_specialty.specialty.name  %></p>
                            <% end  %>
                            <h4>What people had to say about <%= photographer.user.first_name %></h4>
                            <% photographer.bookings.each do |booking| %>
                                <% booking.reviews.each do |review| %>
                                  <div class="booking-review">
                                    <p> <%= review.content %></p>
                                  </div>
                                <% end %>
                            <% end %>
                          </div>

                          <% if @package.name == "How do you want it?" %>
                            <div class="time-slots" data-unavailable="<%= photographer.unavailable_times.to_json %>">
                              <span class="time-slot">12-13</span>
                              <span class="time-slot">13-14</span>
                              <span class="time-slot">14-15</span>
                              <span class="time-slot">15-16</span>
                              <span class="time-slot">16-17</span>
                              <span class="time-slot">17-18</span>
                              <span class="time-slot">18-19</span>
                              <span class="time-slot">19-20</span>
                              <span class="time-slot">20-21</span>
                              <span class="time-slot">21-22</span>
                              <span class="time-slot">22-23</span>
                              <span class="time-slot">23-24</span>
                              <br>
                            </div>
                          <% end %>
                          <div class="modal-footer">
                            <%= simple_form_for [@event, @booking] do |f| %>
                              <%= f.hidden_field :photographer_id, value: photographer.id %>
                              <%= f.hidden_field :package_id, value: @package.id %>
                              <!-- starttime and endtime filled with JS function -->
                              <%= f.hidden_field :start_time  %>
                              <%= f.hidden_field :end_time %>
                              <div class="btn-new">
                              <%= f.button :submit, "Book #{photographer.user.first_name}!" %>
                              </div>
                            <% end %>
                          </div>

                        </div>
                      </div>
                    </div>
                  <% end %>

                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="sr-only">Next</span>
                </a>
     </div>
    </div>
   </div>
 </div>








<script>
  const unavailableTimes = JSON.parse(document.querySelector('.time-slots').dataset.unavailable)
  console.log(unavailableTimes)

  const updateForm = (event) => {
    const slot = event.currentTarget.innerHTML
    const startTime = slot.split("-")[0]
    const endTime = slot.split("-")[1]
    document.querySelector('#booking_start_time').value = startTime
    document.querySelector('#booking_end_time').value = endTime
  }

  const changeColor = (event) => {
    // Set backgrond of all other slots to white, so it is clear only one can be selected
    document.querySelectorAll(".time-slot").forEach( (slot) => {
      if (slot.classList.contains('time-slot-selected')) {
        slot.classList.remove("time-slot-selected");
      };
    })


    const slot = event.currentTarget;
    slot.classList.toggle("time-slot-selected");
  }

  const timeSlots = document.querySelectorAll(".time-slot");
  timeSlots.forEach((slot) => {
    if (unavailableTimes.includes(parseInt(slot.innerHTML.split("-")[0], 10))) {
      slot.classList.add("unavailable-slot");
    } else {
      slot.classList.add("available-slot");
    }

    slot.addEventListener('click', updateForm);
    if (slot.classList.contains('available-slot')) {
      slot.addEventListener('click', changeColor);
    };

  })
</script>


