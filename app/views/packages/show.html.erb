<div class="container col-12 col-lg-6">
  <div class="event-show d-flex justify-content-center">
    <img src=" <%= asset_path(@event.local_img) %>" alt="event picture">
  </div>
  <div class="container d-flex flex-column justify-content-center my-5 col-lg-10 col-md-10 col-sm-10 col-10">
      <%= render 'shared/progress_bar' %>
    <div class="row d-flex align-items-start ml-1">
      <div class="package-show-card d-flex flex-column py-5">
          <p class="d-flex justify-content-center">Package selected</p>
          <a tabindex="0" class="btn btn-lg btn-info w-100" style="background-color: #47ACBC; color: white;" role="button" data-toggle="popover" data-trigger="focus" title="<%= @event.name %> ~ <%= @event.start_date.strftime("%B %d") %>" data-content="<%= @package.bullet1 %> <%= @package.bullet2 %> <%= @package.bullet3 %>"><%= @package.name %> &nbsp<span style="font-size: 12px;">â–º</span></a>
      </div>
    </div>
 </div>
</div>

  <!-- Carousel with navigation -->
  <div class="photographer-carousel mb-5 pb-5 ">
    <div id="photographer-carousel-indicators" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">
        <!-- Carousel content (each with individual modal) -->
        <p class="text-center">Please select one of our professional photographers for <span style="color: #0FABBC; font-size: x-large;"><%= @event.name %></span> </p>
        <% @photographers_present.each_with_index do |photographer, index| %>
          <% active = 'active' if index == 0 %>
          <div class="carousel-item <%= active %>">
            <a data-toggle="modal" data-target="#photographerModal<%= photographer.id %>" >
              <div class="py-3 text-center">
                <h4><%= photographer.user.first_name%> <%=photographer.user.last_name %></h4>
                <p class="py-3">Rating: <%= rand(4.0..5.0).round(1) %> </p>
                <p> <%= photographer.user.first_name %> has worked with <%= rand(30..50) %> Party Reel clients </p>
              </div>
            </a>
          </div>
          <% active='' %>

          <!-- Modal created INSIDE each iteration to refer to that particular photographer -->
          <%= render 'shared/pgr_modal', photographer: photographer %>

        <% end %>
      </div>
      <a class="carousel-control-prev" href="#photographer-carousel-indicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#photographer-carousel-indicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>
</div>

<script>

  const unavailableTimes = JSON.parse(document.querySelector('.time-slots').dataset.unavailable)
  // console.log(unavailableTimes)
  const updateForm = (event) => {
    const slot = event.currentTarget.innerHTML
    const startTime = slot.split("-")[0]
    const endTime = slot.split("-")[1]
    document.querySelector('#booking_start_time').value = startTime
    document.querySelector('#booking_end_time').value = endTime
  }
  const changeColor = (event) => {
    // Set backgrond of all other slots to white, so it is clear only one can be selected
    document.querySelectorAll(".time-slot").forEach( (slot) => {
      if (slot.classList.contains('time-slot-selected')) {
        slot.classList.remove("time-slot-selected");
      };
    })
    const slot = event.currentTarget;
    slot.classList.toggle("time-slot-selected");
  }
  const timeSlots = document.querySelectorAll(".time-slot");
  timeSlots.forEach((slot) => {
    if (unavailableTimes.includes(parseInt(slot.innerHTML.split("-")[0], 10))) {
      slot.classList.add("unavailable-slot");
    } else {
      slot.classList.add("available-slot");
    }
    slot.addEventListener('click', updateForm);
    if (slot.classList.contains('available-slot')) {
      slot.addEventListener('click', changeColor);
    };
  })

    $.('.popover-dismiss').popover({
    trigger: 'focus'
   });



</script>
